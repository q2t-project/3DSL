{
    "$schema": "https://json-schema.org/draft/2020-12/schema", 
    "$id": "https://q2t-project.github.io/3dsl/schemas/3DSS.schema.json#v1.0.2",
    "title": "3DSS Schema v1.0.2",
    "type": "object",
    "properties": {
        "lines": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "signification": {
                        "type": "object",
                        "properties":{
                            "relation": {
                                "type": "object",
                                "properties": {
                                    "structural": {
                                        "type": "string",
                                        "enum": ["association", "containment", "hierarchy"]
                                    },
                                    "dynamic": {
                                        "type": "string",
                                        "enum": ["causal", "flow", "influence", "derivation", "transformation", "feedback", "recursion", "reflection"]
                                    },
                                    "logical": {
                                        "type": "string",
                                        "enum": ["equivalence", "negation", "implication", "support", "conflict"]
                                    },
                                    "temporal": {
                                        "type": "string",
                                        "enum": ["precedence", "succession"]
                                    },
                                    "meta": {
                                        "type": "string",
                                        "enum": ["reference"]
                                    }
                                },
                                "oneOf": [
                                    { "required": ["structural"] },
                                    { "required": ["dynamic"] },
                                    { "required": ["logical"] },
                                    { "required": ["temporal"] },
                                    { "required": ["meta"] }
                                ],"minProperties":1,"maxProperties":1,"additionalProperties": false
                            },
                            "sense": {
                                "type": "string",
                                "enum": ["a_to_b", "b_to_a", "bidirectional", "neutral"],
                                "default": "a_to_b" 
                            }
                        }, "additionalProperties": false
                    },
                    "appearance": {
                        "type": "object",
                        "properties": {
                            "end_a": {
                                "oneOf": [
                                {
                                    "type": "object",
                                    "properties": {
                                    "ref": { "type": "string", "format": "uuid" }
                                    },
                                    "required": ["ref"],
                                    "additionalProperties": false
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                    "coord": {
                                        "$ref": "#/$defs/validator/properties/type_check/properties/vector3"
                                    }
                                    },
                                    "required": ["coord"],
                                    "additionalProperties": false
                                }
                                ]
                            },
                            "end_b": {
                                "oneOf": [
                                {
                                    "type": "object",
                                    "properties": {
                                    "ref": { "type": "string", "format": "uuid" }
                                    },
                                    "required": ["ref"],
                                    "additionalProperties": false
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                    "coord": {
                                        "$ref": "#/$defs/validator/properties/type_check/properties/vector3"
                                    }
                                    },
                                    "required": ["coord"],
                                    "additionalProperties": false
                                }
                                ]
                            },
                            "line_type": {
                                "type": "string",
                                "enum": ["straight", "polyline", "catmullrom", "bezier", "arc"],
                                "default": "straight"
                            }, 
                            "geometry": {
                                "$ref": "#/$defs/validator/properties/line_geometry"
                            },
                            "line_style": {
                                "type": "string",
                                "enum": ["solid", "dashed", "dotted", "double", "none"],
                                "default": "solid"
                            },
                            "color": {
                                "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                "default": "#ffffff"
                            },
                            "opacity": {
                                "type": "number", "minimum":0, "maximum":1,
                                "default":0.4
                            },
                            "renderOrder": {
                                "type": "number",
                                "default":0
                            },
                            "arrow": {
                                "oneOf": [
                                    {
                                        "type": "object",
                                        "properties": {
                                            "primitive": {
                                                "type": "string",
                                                "const": "none"
                                            },
                                            "placement": {
                                                "type": "string",
                                                "enum": ["end_a", "end_b", "both", "none"],
                                                "default": "end_b"
                                            },
                                            "auto_orient": {
                                                "type": "boolean",
                                                "default": true
                                            }
                                        }, "required": ["primitive"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "primitive": {
                                                "type": "string",
                                                "const": "line"
                                            },
                                            "length": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "thickness": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "placement": {
                                                "type": "string",
                                                "enum": ["end_a", "end_b", "both", "none"],
                                                "default": "end_b"
                                            },
                                            "auto_orient": {
                                                "type": "boolean",
                                                "default": true
                                            }
                                        },  "required": ["primitive", "length", "thickness"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "primitive": {
                                                "type": "string",
                                                "const": "cone"
                                            },
                                            "radius": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "height": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "placement": {
                                                "type": "string",
                                                "enum": ["end_a", "end_b", "both", "none"],
                                                "default": "end_b"
                                            },
                                            "auto_orient": {
                                                "type": "boolean",
                                                "default": true
                                            }
                                        }, "required": ["primitive", "radius", "height"], "additionalProperties": false
                                    },
                                    {
                                    "type": "object",
                                        "properties": {
                                            "primitive": {
                                                "type": "string",
                                                "const": "pyramid"
                                            },
                                            "base": {
                                                "type": "array",
                                                "items": {
                                                    "type": "number",
                                                    "minimum": 0.0001
                                                },
                                                "minItems": 2,
                                                "maxItems": 2
                                            },
                                            "height": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "placement": {
                                                "type": "string",
                                                "enum": ["end_a", "end_b", "both", "none"],
                                                "default": "end_b"
                                            },
                                            "auto_orient": {
                                                "type": "boolean",
                                                "default": true
                                            }
                                        }, "required": ["primitive", "base", "height"], "additionalProperties": false
                                    }
                                ]
                            },
                            "bezier_controls": {
                                "$ref": "#/$defs/validator/properties/line_geometry/properties/bezier_controls"
                            },
                            "effect": {
                                "type": "object",
                                "properties": {
                                    "effect_type": {
                                        "type": "string",
                                        "enum": ["none", "pulse", "flow", "glow"],
                                        "default": "none"
                                    },
                                    "amplitude": {
                                        "type": "number", "minimum":0,
                                        "default":1
                                    },
                                    "speed": {
                                        "type": "number", "minimum":0,
                                        "default":1
                                    },
                                    "duration": {
                                        "type": "number", "minimum":0,
                                        "default":1
                                    },
                                    "loop": {
                                        "type": "boolean",
                                        "default": true
                                    },
                                    "phase": {
                                        "type": "number", "minimum":0,"maximum":1,
                                        "default":0
                                    },
                                    "easing": {
                                        "type": "string",
                                        "enum": ["linear", "ease-in", "ease-out", "ease-in-out"],
                                        "default": "linear"
                                    },
                                    "width": {
                                        "type": "number",
                                        "default":1
                                    }
                                }, "additionalProperties": false
                            },
                            "visible":{
                                "type": "boolean"
                            },
                            "frames":{
                                "$ref": "#/$defs/validator/properties/type_check/properties/frames"
                            }
                        }, "additionalProperties": false,
                        "allOf": [
                            {
                                "if": {
                                    "properties": {
                                        "line_type":
                                        {"enum": ["polyline", "catmullrom", "bezier", "arc"]}
                                    }
                                },
                                "then": {
                                    "required": ["geometry"]
                                }
                            } 
                        ]
                    }, 
                    "meta": {
                        "$ref": "#/$defs/meta_core"
                    }
                }, "required": ["appearance", "meta"], "additionalProperties": false
            }
        },

        "points": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "signification": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "oneOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "ja": {"type": "string"},
                                            "en": {"type": "string"}
                                        }, "additionalProperties": false
                                    }
                                ],
                                "default": ""
                            } 
                        }, "additionalProperties": false
                    },
                    "appearance": {
                        "type": "object",
                        "properties": {
                            "position": {"$ref": "#/$defs/spatial/position" },
                            "marker": {
                                "oneOf": [
                                    {
                                        "type": "object",
                                        "properties": {
                                            "common": {
                                                "type": "object",
                                                "properties": {
                                                    "orientation": {
                                                        "$ref": "#/$defs/spatial/orientation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "color": {
                                                        "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                        "default": "#ffffff"
                                                    },
                                                    "opacity": {
                                                        "type": "number",
                                                        "minimum": 0,
                                                        "maximum": 1,
                                                        "default": 0.4
                                                    },
                                                    "emissive": {
                                                        "type": "boolean",
                                                        "default": false
                                                    },
                                                    "wireframe": {
                                                        "type": "boolean",
                                                        "default": false
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "sphere"
                                            },
                                            "radius": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                                "type": "object",
                                                "properties": {
                                                    "content": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "font": {
                                                        "type": "string",
                                                        "default": "helvetiker_regular"
                                                    },
                                                    "size": {
                                                        "type": "number",
                                                        "default": 8
                                                    },
                                                    "align": {
                                                        "type": "string",
                                                        "enum": [
                                                            "left&top",
                                                            "left&middle",
                                                            "left&baseline",
                                                            "center&top",
                                                            "center&middle",
                                                            "center&baseline",
                                                            "right&top",
                                                            "right&middle",
                                                            "right&baseline"
                                                        ],
                                                        "default": "center&middle"
                                                    },
                                                    "plane": {
                                                        "type": "string",
                                                        "enum": ["xy", "yz", "zx", "billboard"],
                                                        "default": "zx"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive", "radius"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "common": {
                                            "type": "object",
                                            "properties": {
                                                "orientation": {
                                                    "$ref": "#/$defs/spatial/orientation",
                                                    "default": [0, 0, 0]
                                                },
                                                "scale": {
                                                    "$ref": "#/$defs/spatial/scale",
                                                    "default": [1, 1, 1]
                                                },
                                                "color": {
                                                    "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                    "default": "#ffffff"
                                                },
                                                "opacity": {
                                                    "type": "number",
                                                    "minimum": 0, "maximum": 1,
                                                    "default": 0.4
                                                },
                                                "emissive": {
                                                    "type": "boolean",
                                                    "default": false
                                                },
                                                "wireframe": {
                                                    "type": "boolean",
                                                    "default": false
                                                }
                                            },  "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "box"
                                            },
                                            "size": {
                                                "type": "array",
                                                "items": {
                                                    "type": "number",
                                                    "minimum": 0.0001
                                                },
                                                "minItems": 3, "maxItems": 3
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                                "type": "object",
                                                "properties": {
                                                    "content": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "font": {
                                                        "type": "string",
                                                        "default": "helvetiker_regular"
                                                    },
                                                    "size": {
                                                        "type": "number",
                                                        "default": 8
                                                    },
                                                    "align": {
                                                        "type": "string",
                                                        "enum": [
                                                            "left&top",
                                                            "left&middle",
                                                            "left&baseline",
                                                            "center&top",
                                                            "center&middle",
                                                            "center&baseline",
                                                            "right&top",
                                                            "right&middle",
                                                            "right&baseline"
                                                        ], "default": "center&middle"
                                                    },
                                                    "plane": {
                                                        "type": "string",
                                                        "enum": ["xy", "yz", "zx", "billboard"],
                                                        "default": "zx"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive", "size"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "common": {
                                                "type": "object",
                                                "properties": {
                                                    "orientation": {
                                                        "$ref": "#/$defs/spatial/orientation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "color": {
                                                        "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                        "default": "#ffffff"
                                                    },
                                                    "opacity": {
                                                        "type": "number",
                                                        "minimum": 0,
                                                        "maximum": 1,
                                                        "default": 0.4
                                                    },
                                                    "emissive": {
                                                        "type": "boolean",
                                                        "default": false
                                                    },
                                                    "wireframe": {
                                                        "type": "boolean",
                                                        "default": false
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "cone"
                                            },
                                            "radius": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "height": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                                "type": "object",
                                                "properties": {
                                                    "content": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "font": {
                                                        "type": "string",
                                                        "default": "helvetiker_regular"
                                                    },
                                                    "size": {
                                                        "type": "number",
                                                        "default": 8
                                                    },
                                                    "align": {
                                                        "type": "string",
                                                        "enum": [
                                                            "left&top",
                                                            "left&middle",
                                                            "left&baseline",
                                                            "center&top",
                                                            "center&middle",
                                                            "center&baseline",
                                                            "right&top",
                                                            "right&middle",
                                                            "right&baseline"
                                                        ],
                                                        "default": "center&middle"
                                                    },
                                                    "plane": {
                                                        "type": "string",
                                                        "enum": ["xy", "yz", "zx", "billboard"],
                                                        "default": "zx"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive", "radius", "height"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "common": {
                                                "type": "object",
                                                "properties": {
                                                    "orientation": {
                                                        "$ref": "#/$defs/spatial/orientation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "color": {
                                                        "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                        "default": "#ffffff"
                                                    },
                                                    "opacity": {
                                                        "type": "number",
                                                        "minimum": 0, "maximum": 1,
                                                        "default": 0.4
                                                    },
                                                    "emissive": {
                                                        "type": "boolean",
                                                        "default": false
                                                    },
                                                    "wireframe": {
                                                        "type": "boolean",
                                                        "default": false
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "pyramid"
                                            },
                                            "base": {
                                                "type": "array",
                                                "items": {
                                                    "type": "number",
                                                    "minimum": 0.0001
                                                },
                                                "minItems": 2, "maxItems": 2
                                            },
                                            "height": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                                "type": "object",
                                                "properties": {
                                                    "content": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "font": {
                                                        "type": "string",
                                                        "default": "helvetiker_regular"
                                                    },
                                                    "size": {
                                                        "type": "number",
                                                        "default": 8
                                                    },
                                                    "align": {
                                                        "type": "string",
                                                        "enum": [
                                                            "left&top",
                                                            "left&middle",
                                                            "left&baseline",
                                                            "center&top",
                                                            "center&middle",
                                                            "center&baseline",
                                                            "right&top",
                                                            "right&middle",
                                                            "right&baseline"
                                                        ], "default": "center&middle"
                                                    },
                                                    "plane": {
                                                        "type": "string",
                                                        "enum": ["xy", "yz", "zx", "billboard"],
                                                        "default": "zx"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive", "base", "height"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                                "common": {
                                                "type": "object",
                                                "properties": {
                                                    "orientation": {
                                                        "$ref": "#/$defs/spatial/orientation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "color": {
                                                        "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                        "default": "#ffffff"
                                                    },
                                                    "opacity": {
                                                        "type": "number",
                                                        "minimum": 0, "maximum": 1,
                                                        "default": 0.4
                                                    },
                                                    "emissive": {
                                                        "type": "boolean",
                                                        "default": false
                                                    },
                                                    "wireframe": {
                                                        "type": "boolean",
                                                        "default": false
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "corona"
                                            },
                                            "inner_radius": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "outer_radius": {
                                                "type": "number",
                                                "minimum": 0.0001
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                                "type": "object",
                                                "properties": {
                                                    "content": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "font": {
                                                        "type": "string",
                                                        "default": "helvetiker_regular"
                                                    },
                                                    "size": {
                                                        "type": "number",
                                                        "default": 8
                                                    },
                                                    "align": {
                                                        "type": "string",
                                                        "enum": [
                                                            "left&top",
                                                            "left&middle",
                                                            "left&baseline",
                                                            "center&top",
                                                            "center&middle",
                                                            "center&baseline",
                                                            "right&top",
                                                            "right&middle",
                                                            "right&baseline"
                                                        ],
                                                        "default": "center&middle"
                                                    },
                                                    "plane": {
                                                        "type": "string",
                                                        "enum": ["xy", "yz", "zx", "billboard"],
                                                        "default": "zx"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive", "inner_radius", "outer_radius"], "additionalProperties": false
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "common": {
                                            "type": "object",
                                            "properties": {
                                                "orientation": {
                                                    "$ref": "#/$defs/spatial/orientation",
                                                    "default": [0, 0, 0]
                                                },
                                                "scale": {
                                                    "$ref": "#/$defs/spatial/scale",
                                                    "default": [1, 1, 1]
                                                },
                                                "color": {
                                                    "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                    "default": "#ffffff"
                                                },
                                                "opacity": {
                                                    "type": "number",
                                                    "minimum": 0, "maximum": 1,
                                                    "default": 0.4
                                                },
                                                "emissive": {
                                                    "type": "boolean",
                                                    "default": false
                                                },
                                                "wireframe": {
                                                    "type": "boolean",
                                                    "default": false
                                                }
                                            },
                                            "additionalProperties": false
                                            },
                                            "primitive": {
                                                "type": "string",
                                                "const": "none"
                                            },
                                            "gltf": {
                                                "type": "object",
                                                "properties": {
                                                    "url": {
                                                        "type": "string",
                                                        "default": ""
                                                    },
                                                    "scale": {
                                                        "$ref": "#/$defs/spatial/scale",
                                                        "default": [1, 1, 1]
                                                    },
                                                    "rotation": {
                                                        "$ref": "#/$defs/spatial/rotation",
                                                        "default": [0, 0, 0]
                                                    },
                                                    "offset": {
                                                        "$ref": "#/$defs/spatial/offset",
                                                        "default": [0, 0, 0]
                                                    }
                                                }, "additionalProperties": false
                                            },
                                            "text": {
                                            "type": "object",
                                            "properties": {
                                                "content": {
                                                    "type": "string",
                                                    "default": ""
                                                },
                                                "font": {
                                                    "type": "string",
                                                    "default": "helvetiker_regular"
                                                },
                                                "size": {
                                                    "type": "number",
                                                    "default": 8
                                                },
                                                "align": {
                                                    "type": "string",
                                                    "enum": [
                                                        "left&top",
                                                        "left&middle",
                                                        "left&baseline",
                                                        "center&top",
                                                        "center&middle",
                                                        "center&baseline",
                                                        "right&top",
                                                        "right&middle",
                                                        "right&baseline"
                                                    ],
                                                    "default": "center&middle"
                                                },
                                                "plane": {
                                                    "type": "string",
                                                    "enum": ["xy", "yz", "zx", "billboard"],
                                                    "default": "zx"
                                                }
                                            }, "additionalProperties": false
                                            }
                                        }, "required": ["primitive"], "additionalProperties": false
                                    }
                                ]
                            },
                            "visible": {
                                "type": "boolean"
                            },
                            "frames": {
                                "$ref": "#/$defs/validator/properties/type_check/properties/frames"
                            }
                        }, "required": ["position"], "additionalProperties": false
                    },
                    "meta": {
                        "$ref": "#/$defs/meta_core"
                    }
                },"required": ["appearance", "meta"], "additionalProperties": false 
            } 
        },

        "aux": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "appearance": {
                        "type": "object",
                        "properties": {
                            "position": {
                                "$ref": "#/$defs/spatial/position",
                                "default": [0,0,0]
                            },
                            "orientation": {
                                "$ref": "#/$defs/spatial/orientation",
                                "default": [0,0,0]
                            },
                            "opacity": {
                                "type": "number", "minimum":0, "maximum":1,
                                "default":0.4
                            },
                            "module": {
                                "type": "object",
                                "properties": {
                                    "grid": {
                                        "type": "object",
                                        "properties": {
                                            "grid_type": {
                                                "type": "string",
                                                "enum": ["cartesian", "polar"],
                                                "default": "cartesian"
                                            },
                                            "subdivisions": {
                                                "type": "integer",
                                                "default": 8
                                            },
                                            "major_step": {
                                                "type": ["number", "integer"],
                                                "default":4 
                                            },
                                            "minor_step": {
                                                "type": ["number", "integer"],
                                                "default":1
                                            },
                                            "color_major": {
                                                "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                "default": "#666666"
                                            },
                                            "color_minor": {
                                                "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                "default": "#333333"
                                            }
                                        }, "additionalProperties": false
                                    },
                                    "axis": {
                                        "type": "object",
                                        "properties": {
                                            "length": {
                                                "type": ["number", "integer"],
                                                "default": 64
                                            },
                                            "labels": {
                                                "type": "boolean",
                                                "default": true
                                            },
                                            "arrow": {
                                                "oneOf": [
                                                    {
                                                        "type": "object",
                                                        "properties": {
                                                            "primitive": {
                                                                "type": "string",
                                                                "const": "none"
                                                            }
                                                        }, "required": ["primitive"], "additionalProperties": false
                                                    },
                                                    {
                                                        "type": "object",
                                                        "properties": {
                                                            "primitive": {
                                                                "type": "string",
                                                                "const": "line"
                                                            },
                                                            "length": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            },
                                                            "thickness": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            }
                                                        }, "required": ["primitive", "length", "thickness"], "additionalProperties": false
                                                    },
                                                    {
                                                        "type": "object",
                                                        "properties": {
                                                            "primitive": {
                                                                "type": "string",
                                                                "const": "cone"
                                                            },
                                                            "radius": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            },
                                                            "height": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            }
                                                        }, "required": ["primitive", "radius", "height"], "additionalProperties": false
                                                    },
                                                    {
                                                        "type": "object",
                                                        "properties": {
                                                            "primitive": {
                                                                "type": "string",
                                                                "const": "pyramid"
                                                            },
                                                            "base": {
                                                            "type": "array",
                                                            "items": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            },
                                                            "minItems": 2, "maxItems": 2
                                                            },
                                                            "height": {
                                                                "type": "number",
                                                                "minimum": 0.0001
                                                            }
                                                        }, "required": ["primitive", "base", "height"],"additionalProperties": false
                                                    }
                                                ]
                                            }
                                        }, "additionalProperties": false
                                    },
                                    "plate": {
                                        "type": "object",
                                        "properties": {
                                            "plane": {
                                                "type": "string",
                                                "enum": ["xy", "yz", "zx"],
                                                "default": "xy"
                                            },
                                            "position": {
                                                "$ref": "#/$defs/spatial/position",
                                                "default": [0,0,0]
                                            },
                                            "size": {
                                                "type": "array",
                                                "items": {"type": "number"}, "minItems":2, "maxItems":2,
                                                "default": [32,32]
                                            },
                                            "reflectivity": {
                                                "type": "number", "minimum":0, "maximum":1,
                                                "default":0.5
                                            },
                                            "opacity": {
                                                "type": "number", "minimum":0, "maximum":1,
                                                "default":0.4
                                            }
                                        },"additionalProperties": false
                                    },
                                    "shell": {
                                        "type": "object",
                                        "properties": {
                                            "shell_type": {
                                                "type": "string",
                                                "enum": ["sphere", "box", "hemisphere", "quarter_sphere", "eighth_sphere"],
                                                "default": "sphere"
                                            },
                                            "opacity": {
                                                "type": "number", "minimum":0, "maximum":1,
                                                "default":0.4
                                            },
                                            "reflectivity": {
                                                "type": "number", "minimum":0, "maximum":1,
                                                "default":0.5
                                            },
                                            "effect": {
                                                "type": "object",
                                                "properties": {
                                                    "edge_intensity": {
                                                        "type": "number", "minimum":0, "maximum":1,
                                                        "default":0.5
                                                    },
                                                    "rimlight": {
                                                        "type": "boolean",
                                                        "default": false
                                                    },
                                                    "glow_color": {
                                                        "$ref": "#/$defs/validator/properties/type_check/properties/color",
                                                        "default": "#ff0000"
                                                    }
                                                }, "additionalProperties": false
                                            }
                                        }, "additionalProperties": false
                                    },
                                    "hud": {
                                        "type": "object",
                                        "properties": {
                                            "follow_camera": {
                                                "type": "boolean",
                                                "default": true
                                            },
                                            "scale_with_distance": {
                                                "type": "boolean","default": true
                                            }
                                        }, "additionalProperties": false
                                    },
                                    "extension": {
                                        "type": "object",
                                        "properties": {
                                            "type": { "type": "string" },
                                            "latex": { "$ref": "#/$defs/extension/latex" },
                                            "parametric": { "$ref": "#/$defs/extension/parametric" }
                                        }, "additionalProperties": false
                                    }
                                }, "additionalProperties": false
                            },
                            "visible": {
                                "type": "boolean"
                            },
                            "frames": {
                                "$ref": "#/$defs/validator/properties/type_check/properties/frames"
                            }
                        },"additionalProperties": false
                    },
                    "meta": {
                        "$ref": "#/$defs/meta_core"
                    }
                },"required": ["meta"], "additionalProperties": false
            }
        },

        "document_meta": {
            "type": "object",
            "properties": {
                "document_uuid": {
                    "type": "string",
                    "format": "uuid" },
                "version": {
                    "type": "string",
                    "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?$",
                    "default": "1.0.0" },
                "updated_at": {
                    "type": "string",
                    "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$" },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^(s|m|x):[\\w\\p{L}\\p{N}\\-]+$"
                    },
                        "default": []
                },
                "schema_uri": {
                    "type": "string",
                    "format": "uri"
                },
                "generator": {
                    "type": "string",
                    "format": "uri-reference",
                    "default": "https://q2t-project.github.io/3dsl/"
                },
                "reference": {
                    "type": "string",
                    "default": ""
                },
                "coordinate_system": {
                    "type": "string",
                    "const": "Z+up/freeXY"
                },
                "units": {
                    "type": "string",
                    "enum": ["m", "cm", "mm", "non_si:px"],
                    "default": "mm"
                },
                "i18n": {
                    "type": "string",
                    "enum": ["ja", "en"],
                    "default": "ja"
                },
                "author": {
                    "type": "string",
                    "pattern": "^[a-zA-Z0-9._-]+(@[a-zA-Z0-9.-]+)?$"
                },
                "creator_memo": {
                    "type": "string"
                }
            },"required": ["document_uuid","schema_uri","author","version"], "additionalProperties": false
        }
    }, "required": ["document_meta"], "additionalProperties": false,


    "$defs": {
        "validator": {
            "type": "object",
            "properties": {
                "type_check": {
                    "type": "object",
                    "properties": {
                        "uuid": {
                            "type": "string",
                            "format": "uuid"
                        },
                        "uri": {
                            "type": "string",
                            "format": "uri"
                        },
                        "color": {
                            "type": "string",
                            "pattern": "^#(?:[0-9a-fA-F]{3}){1,2}$"
                        },
                        "language_code": {
                            "type": "string",
                            "enum": ["ja", "en"]
                        },
                        "units": {
                            "type": "string",
                            "enum": ["m", "cm", "mm", "non_si:px"]
                        },
                        "vector3": {
                            "type": "array",
                            "items": {"type": "number" }, "minItems":3, "maxItems":3
                        },
                        "frames": {
                            "oneOf": [
                                {"type": "integer", "minimum":-9999, "maximum":9999 },
                                {"type": "array",
                                    "items": {
                                        "type": "integer", "minimum":-9999, "maximum":9999
                                    },"uniqueItems": true,"minItems":1,"maxItems":256 }
                            ]
                        }
                    }, "additionalProperties": false
                },
                "pattern": {
                    "type": "object",
                    "properties": {
                        "tag": {
                            "type": "string",
                            "pattern": "^(s|m|x):[\\w\\-\\p{L}\\p{N}]+$"
                        },
                        "uuid_v4": {
                            "type": "string",
                            "pattern": "^[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-4[0-9a-fA-F]{3}\\-[89abAB][0-9a-fA-F]{3}\\-[0-9a-fA-F]{12}$"
                        },
                        "uri": {
                            "type": "string",
                            "pattern": "^(https?|ftp|file)://[-\\w.]+(/[\\w\\-./?%&=]*)?$"
                        },
                        "semver": {
                            "type": "string",
                            "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?$"
                        },
                        "timestamp_utc": {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
                        },
                        "author": {
                            "type": "string",
                            "pattern": "^[a-zA-Z0-9._-]+(@[a-zA-Z0-9.-]+)?$"
                        },
                        "lang_code": {
                            "type": "string",
                            "pattern": "^(ja|en)$" },
                        "units": {
                            "type": "string",
                            "pattern": "^(m|cm|mm|non_si:px)$"
                        },
                        "path_ref": {
                            "type": "string",
                            "pattern": "^[\\w\\-/\\.]+$"
                        }
                    }, "additionalProperties": false
                },
                "line_geometry": {
                    "type": "object",
                    "properties": {
                        "dimension": {
                            "type": "integer",
                            "enum": [2,3]
                        },
                        "polyline_points": {
                            "type": "array",
                            "items": {
                                "type": "array",
                                "items": {"type": "number"}, "minItems":3, "maxItems":3
                            }
                        },
                        "bezier_controls": {
                            "type": "array", "minItems":1, "maxItems":2,
                            "items": {
                                "type": "array", 
                                "items": {"type": "number" }, "minItems":3, "maxItems":3
                            }
                        },
                        "arc_center": {
                            "type": "array",
                            "items": {"type": "number"}, "minItems":3, "maxItems":3
                        },
                        "arc_radius": {
                            "type": "number","minimum":0
                        },
                        "arc_angle_start": {
                            "type": "number"
                        },
                        "arc_angle_end": {
                            "type": "number"
                        },
                        "arc_clockwise": {
                            "type": "boolean"
                        },
                        "catmullrom_points": {
                            "type": "array",
                            "items": {
                                "type": "array",
                                "items": {"type": "number"}, "minItems":3, "maxItems":3
                            }
                        },
                        "catmullrom_tension": {
                            "type": "number", "minimum":0, "maximum":1
                        }
                    }, "additionalProperties": false
                }
            }, "additionalProperties": false
        },
        "spatial": {
            "position": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
            },
            "orientation": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
            },
            "scale": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
            },
            "rotation": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
            },
            "offset": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
            }
        },

        "extension": {
            "parametric": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string", "minLength":1
                    },
                    "version": {
                        "$ref": "#/$defs/validator/properties/pattern/properties/semver"
                    },
                    "params": {
                        "type": "object", "additionalProperties": {
                            "anyOf": [
                                {"type": "number"},
                                {"type": "integer"},
                                {"type": "boolean"},
                                {"type": "string"},
                                {"type": "array", 
                                    "items": {"type": "number"}
                                }
                            ]
                        }
                    },
                    "bindings": {
                        "type":"array",
                        "items": { "type": "object",
                            "properties": {
                                "target": { "$ref": "#/$defs/validator/properties/pattern/properties/path_ref" },
                                "expression": {
                                    "type": "string", "minLength":1
                                    }
                            },"required": ["target", "expression"], "additionalProperties": false
                        }
                    },
                    "seed": {
                        "type": "integer"
                    } 
                }, "required": ["type"], "additionalProperties": false
            },
            "latex": {
                "type": "object",
                "properties": {
                    "content": {
                        "type": "string", "minLength":1
                    },
                    "render_mode": {
                        "type": "string",
                        "enum": ["math", "inline", "block"]
                    },
                    "font_size": {
                        "type": "number"
                    },
                    "color": {
                        "$ref": "#/$defs/validator/properties/type_check/properties/color"
                    }, 
                    "plane": {
                        "type": "string",
                        "enum": ["xy", "yz", "zx", "billboard"]
                    },
                    "position": {
                        "$ref": "#/$defs/validator/properties/type_check/properties/vector3"
                    } 
                }, "required": ["content"], "additionalProperties": false
            }
        },
        "meta_core": {
            "type": "object",
            "properties": {
                "uuid": {
                    "type": "string",
                    "format": "uuid"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^(s|m|x):[\\w\\p{L}\\p{N}\\-]+$"
                    }
                },
                "creator_memo": { "type": "string" } 
            }, "required": ["uuid"],"additionalProperties": false 
        }
    }
}
