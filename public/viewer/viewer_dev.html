<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>3DSL Viewer â€“ Dev Harness</title>
    <style>

      /* è¿½åŠ ï¼šå…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ 2 ã‚«ãƒ©ãƒ ã®ã‚°ãƒªãƒƒãƒ‰ã«ã—ã¦ã€é«˜ã•ã‚’ç”»é¢ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹ */
      #viewer-layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 240px; /* å·¦=3Dãƒ“ãƒ¥ãƒ¼, å³=ãƒ¡ã‚¿ã‚¨ãƒªã‚¢ */
      height: 100vh; /* ç”»é¢ã®é«˜ã•ã«å›ºå®š */
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      body {
        background: #000;
        color: #ddd;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        overflow: hidden; /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å°ã˜ã‚‹ */
      }

      /* å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼š
         å·¦ = 3D ãƒ“ãƒ¥ãƒ¼
         ä¸­ = 300Ã—600 åºƒå‘Šã‚¹ãƒˆãƒªãƒƒãƒ—
         å³ = ãƒ¡ã‚¿æƒ…å ±ã‚¨ãƒªã‚¢ï¼ˆã‚„ã‚„ç´°ã‚ï¼‰ */
         
      #viewer-main {
        position: relative;
        background: #111;
        overflow: hidden;
        touch-action: none; /* ã‚¿ãƒƒãƒï¼ãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æŠ‘æ­¢ */
        height: 100%;       /* ã‚°ãƒªãƒƒãƒ‰è¡Œã„ã£ã±ã„ã«ä¼¸ã°ã™ */
      }

      #viewer-canvas {
        width: 100%;
        height: 100%;
        display: block;
        background: #111;
        touch-action: none;
      }

      /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå³ä¸Šã® 300Ã—250 ADï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼‰ */
      #ad-slot-300x250 {
        position: absolute;
        right: 12px;
        top: 40px;
        width: 300px;
        height: 250px;
        border-radius: 4px;
        border: 1px dashed rgba(255, 255, 255, 0.4);
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.7);
        pointer-events: auto; /* å°†æ¥ã®åºƒå‘Šã‚¯ãƒªãƒƒã‚¯ç”¨ */
      }

      /* ä¸­å¤®ã‚¹ãƒˆãƒªãƒƒãƒ—ï¼š300Ã—600 AD ç”¨ã‚«ãƒ©ãƒ  */
      #viewer-ad-strip {
        background: #050505;
        border-left: 1px solid rgba(255, 255, 255, 0.12);
        border-right: 1px solid rgba(255, 255, 255, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #ad-slot-300x600 {
        width: 300px;
        height: 600px;
        border-radius: 4px;
        border: 1px dashed rgba(255, 255, 255, 0.4);
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.7);
      }

      /* å³å´ï¼šãƒ¡ã‚¿æƒ…å ±ã‚¨ãƒªã‚¢ï¼ˆç´°ã‚ï¼‰ */
      #viewer-meta {
        background: #050505;
        border-left: 1px solid rgba(255, 255, 255, 0.12);
        display: flex;
        flex-direction: column;
        font-size: 11px;
        min-width: 220px;
        max-width: 260px;
      }

      /* å³ãƒ‘ãƒãƒ«æœ€ä¸Šéƒ¨ï¼šãƒ­ã‚´ãƒ˜ãƒƒãƒ€ */
      #meta-header {
        flex: 0 0 auto;
        padding: 1px 10px 2px; /* ãƒ­ã‚´ç›´ä¸‹ã¾ã§è©°ã‚ã‚‹ */
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      #meta-logo-link {
        display: inline-block;
      }

      #meta-logo {
        display: block;
        height: 112px;
        width: auto;
        filter: invert(1); /* é»’ãƒ­ã‚´ã‚’ç™½åŸºèª¿ã«åè»¢ */
      }

      /* ãƒ¡ã‚¿æƒ…å ±ã‚¨ãƒªã‚¢ï¼ˆä¸Šä¸‹åˆ†å‰²ï¼‰ */
      #meta-file,
      #meta-model {
        padding: 4px 2px 8px;
        overflow-y: auto;
      }

      /* ä¸Šï¼šãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ï¼ˆå›ºå®šé«˜ã• 40%ï¼‰ */
      #meta-file {
        flex: 0 0 40%;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* ä¸‹ï¼šãƒ¢ãƒ‡ãƒ«ãƒ¡ã‚¿ï¼‹ãƒ­ã‚°ï¼ˆæ®‹ã‚Šå…¨éƒ¨ï¼‰ */
      #meta-model {
        flex: 1 1 auto;
      }

      #viewer-meta h3 {
        margin: 0 0 4px 0;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        opacity: 0.9;
      }

      #viewer-meta pre {
        margin: 4px 0 0 0;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 10px;
      }

      /* ä¸Šéƒ¨ HUDï¼ˆãƒˆãƒ¼ã‚¹ãƒˆç”¨ï¼‰ */
      #viewer-hud {
        position: absolute;
        top: 16px;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        max-width: 60%;
        padding: 8px 14px;
        background: rgba(0, 0, 0, 0.85);
        color: #eee;
        font-size: 12px;
        line-height: 1.4;
        border-radius: 999px;
        pointer-events: none;
        opacity: 0;
        transform-origin: top center;
        transition:
          opacity 0.25s ease-out,
          transform 0.25s ease-out;
      }

      #viewer-hud.hud-visible {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      #viewer-hud.hud-hidden {
        opacity: 0;
        transform: translateX(-50%) translateY(-8px);
      }

      /* ãƒ¬ãƒ™ãƒ«åˆ¥è‰² */
      #viewer-hud.hud-info {
        background: rgba(0, 0, 0, 0.85);
      }

      #viewer-hud.hud-warn {
        background: rgba(190, 140, 32, 0.9);
      }

      #viewer-hud.hud-error {
        background: rgba(180, 32, 32, 0.9);
      }

      /* ä¸‹éƒ¨ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆframe / å†ç”Ÿ / filterï¼‰ */
      #viewer-toolbar {
        position: absolute;
        left: 12px;
        bottom: 12px;
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.7);
        color: #eee;
        font-size: 11px;
        border-radius: 4px;
        pointer-events: auto;
        display: inline-flex;
        align-items: flex-start;
        gap: 12px;
      }

      .toolbar-main {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .frame-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      /* ã‚¹ãƒ©ã‚¤ãƒ€ã¯ã‚„ã‚„çŸ­ã‚ */
      #frame-slider {
        width: 8vw;
        min-width: 160px;
        max-width: 260px;
      }

      #viewer-toolbar button {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 3px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.04);
        color: #eee;
        cursor: pointer;
      }

      #viewer-toolbar button:hover {
        background: rgba(255, 255, 255, 0.12);
      }

      /* frame controlsï¼ˆé€£ç¶š / ãƒ‘ãƒ©ãƒ‘ãƒ© 2 æ®µï¼‰ */
      #frame-controls {
        display: flex;
        flex-direction: column;
        gap: 2px;
        margin-top: 4px;
      }

      #frame-controls .row {
        display: flex;
        gap: 4px;
      }

      #frame-controls .row-continuous,
      #frame-controls .row-flip {
        opacity: 0.4;
        transition: opacity 0.15s ease-out;
      }

      #frame-controls.mode-continuous .row-continuous,
      #frame-controls.mode-flip .row-flip {
        opacity: 1;
      }

      /* filterï¼šframe ã®å³ã«ç¸¦ä¸¦ã³ã§ 3 ã¤ */
      .filter-column {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-top: 18px;
      }

      .filter-toggle {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 2px 6px;
        border-radius: 3px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.02);
      }

      .filter-toggle .icon {
        font-size: 13px;
      }

      .filter-toggle.filter-off {
        opacity: 0.3;
      }

      /* ã‚­ãƒ¼æ“ä½œç³»ã®çµ±ä¸€ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆkeycap é¢¨ï¼‰ */
      .keycap {
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.8);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      .keycap:hover {
        background: rgba(255, 255, 255, 0.18);
      }

      /* ã‚«ãƒ¡ãƒ©ãƒ‘ãƒãƒ«ï¼ˆmode ã‚¹ã‚¿ãƒƒã‚¯ï¼‹ã‚®ã‚ºãƒ¢ï¼‹çŸ¢å°ãƒŠãƒ“ï¼‰ */
      #camera-panel {
        position: absolute;
        right: 12px;
        bottom: 12px; /* å³ä¸‹å›ºå®šï¼šmode ã‚¹ã‚¿ãƒƒã‚¯å°‚ç”¨ */
        display: flex;
        align-items: flex-end;
        pointer-events: none; /* å­è¦ç´ å´ã§å¿…è¦ãªã¨ã“ã‚ã ã‘ auto ã«ã™ã‚‹ */
      }

      #mode-stack {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 11px;
        pointer-events: auto;
      }

      .mode-pill {
        min-width: 72px;
        padding: 3px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        background: rgba(0, 0, 0, 0.7);
        text-align: center;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0.5;
        filter: blur(1px); /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¯è»½ãã¼ã‹ã™ */
        transition: all 0.15s ease-out;
      }

      .mode-pill-active {
        background: #ffffff;
        color: #000000;
        opacity: 1;
        filter: none; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¯ãã£ãã‚Š */
      }

      .mode-micro-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .mode-focus-label {
        font-size: 11px;
        max-width: 140px;
        padding-left: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        opacity: 0.85;
      }

      .mode-focus-toggle {
        align-self: flex-start;
        margin-top: 2px;
        padding: 1px 8px;
        font-size: 10px;
        color: #eee;
        cursor: pointer;
      }

      /* Gizmo æœ¬ä½“ */
      #gizmo-wrapper {
        position: absolute;
        right: 120px;
        bottom: 12px;
        width: 180px;
        height: 180px;
        pointer-events: auto;
        z-index: 20; /* ã»ã‹ã® HUD ã‚ˆã‚Šå°‘ã—å‰ */
      }

      /* æ ã¯ absolute ã§ç®±ã„ã£ã±ã„ã«åºƒã’ã‚‹ï¼ˆãƒ•ãƒ­ãƒ¼ã‹ã‚‰å¤–ã™ï¼‰ */
      #gizmo-slot {
        position: absolute;
        inset: 0; /* top:0; right:0; bottom:0; left:0 ã¨åŒã˜ */
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
      }

      /* ã€ŒGIZMOã€ãƒ©ãƒ™ãƒ«ã¯æ ã®ä¸­å¤® */
      #gizmo-slot::before {
        content: "GIZMO";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 10px;
        opacity: 0.6;
      }

      /* HOME ãƒœã‚¿ãƒ³ï¼ˆå·¦ä¸Šï¼‰ */
      #gizmo-home {
        position: absolute;
        left: 4px;
        top: 4px;
        padding: 1px 8px;
        font-size: 9px;
        line-height: 1.4;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.8);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        cursor: pointer;
      }

      #gizmo-home:hover {
        background: rgba(255, 255, 255, 0.18);
      }

      /* X/Y/Z è¡Œï¼ˆå³ä¸‹ã«çµ¶å¯¾é…ç½®ï¼‰ */
      .gizmo-axis-row {
        position: absolute;
        right: 4px;
        bottom: 4px;
        display: flex;
        gap: 4px;
      }

      .gizmo-axis {
        width: 22px;
        height: 22px;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(0, 0, 0, 0.8);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        cursor: pointer;
      }

      .gizmo-axis:hover {
        background: rgba(255, 255, 255, 0.18);
      }

      /* ------------------------------------------------------------
      * Gizmo: SVG ã¯ç´ é€šã‚Šã€ãƒœã‚¿ãƒ³ã ã‘ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯ã«ã™ã‚‹
      * ---------------------------------------------------------- */

      /* gizmo wrapper è‡ªä½“ã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚‹ï¼ˆä¸Šã§ pointer-events: auto æ¸ˆï¼‰ */
      /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½é ˜åŸŸã¯ #gizmo-wrapper é…ä¸‹ã®ãƒœã‚¿ãƒ³é¡ */

      /* ä¸­ã«æã„ã¦ã„ã‚‹ SVG ã¯ã‚¯ãƒªãƒƒã‚¯ã‚’æ®ºã•ãšç´ é€šã‚Šã•ã›ã‚‹ */
      #gizmo-slot svg {
        pointer-events: none;
      }

      /* HOME / X / Y / Z ã®ãƒœã‚¿ãƒ³ã¯ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
      #gizmo-wrapper button,
      #gizmo-wrapper .keycap,
      #gizmo-wrapper .gizmo-axis {
        pointer-events: auto;
        position: relative;
        z-index: 30;
      }

    </style>
  </head>

  <body>
    <div id="viewer-layout">
      <!-- å·¦ï¼š3D ãƒ“ãƒ¥ãƒ¼ï¼‹HUDï¼‹ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼‹ã‚®ã‚ºãƒ¢ï¼‹300Ã—250 AD -->
      <div id="viewer-main">
        <canvas id="viewer-canvas"></canvas>

        <!-- HUD: ä¸€æ™‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ãƒˆãƒ¼ã‚¹ãƒˆ -->
        <div id="viewer-hud" class="hud-hidden"></div>

        <!-- ä¸‹éƒ¨ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
        <div id="viewer-toolbar">
          <div class="toolbar-main">
            <!-- frame / å†ç”Ÿ -->
            <div class="frame-block">
              <div style="opacity: 0.8">
                Frame: <span id="frame-slider-label">0</span>
              </div>
              <input
                id="frame-slider"
                type="range"
                min="0"
                max="0"
                value="0"
                step="1"
              />

              <!-- 2 æ®µæ§‹æˆï¼šä¸Šæ®µï¼é€£ç¶šå†ç”Ÿãƒ¢ãƒ¼ãƒ‰ / ä¸‹æ®µï¼ãƒ‘ãƒ©ãƒ‘ãƒ©ã‚ãã‚Š -->
              <div id="frame-controls" class="mode-flip">
                <!-- 1 è¡Œç›®ï¼šé€£ç¶šå†ç”Ÿãƒ¢ãƒ¼ãƒ‰ -->
                <div class="row row-continuous">
                  <button id="btn-rew" title="é€†é€ã‚Šï¼ˆæœ€å°ã¾ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰">
                    â®
                  </button>
                  <button id="btn-play" title="å†ç”Ÿ / ä¸€æ™‚åœæ­¢ (Space)">
                    Play
                  </button>
                  <button id="btn-ff" title="å…ˆé€ã‚Šï¼ˆæœ€å¤§ã¾ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰">
                    â­
                  </button>
                </div>
                <!-- 2 è¡Œç›®ï¼šãƒ‘ãƒ©ãƒ‘ãƒ©ã‚ãã‚Šãƒ¢ãƒ¼ãƒ‰ -->
                <div class="row row-flip">
                  <button id="btn-step-back" title="1 ãƒ•ãƒ¬ãƒ¼ãƒ æˆ»ã‚‹ (PgDn)">
                    â—€
                  </button>
                  <button id="btn-home" title="ãƒ›ãƒ¼ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ  (0)">â—</button>
                  <button
                    id="btn-step-forward"
                    title="1 ãƒ•ãƒ¬ãƒ¼ãƒ é€²ã‚€ (PgUp)"
                  >
                    â–¶
                  </button>
                </div>
              </div>
            </div>

            <!-- filter -->
            <div class="filter-column">
              <button
                id="filter-lines"
                class="filter-toggle filter-on"
                type="button"
                title="toggle lines"
              >
                <span class="icon">ğŸ‘</span><span class="label">lines</span>
              </button>
              <button
                id="filter-points"
                class="filter-toggle filter-on"
                type="button"
                title="toggle points"
              >
                <span class="icon">ğŸ‘</span><span class="label">points</span>
              </button>
              <button
                id="filter-aux"
                class="filter-toggle filter-on"
                type="button"
                title="toggle aux"
              >
                <span class="icon">ğŸ‘</span><span class="label">aux</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆå³ä¸‹å›ºå®šï¼‰ -->
        <div id="camera-panel">
          <div id="mode-stack">
              <div id="mode-label-macro" class="mode-pill mode-pill-active">
              MACRO
            </div>

            <!-- MESO ãƒ¢ãƒ¼ãƒ‰ pill -->
            <div id="mode-label-meso" class="mode-pill">
              MESO
            </div>

            <div class="mode-micro-block">
              <div id="mode-label-micro" class="mode-pill">micro</div>
              <button
                id="mode-focus-toggle"
                class="mode-focus-toggle keycap"
                type="button"
                title="Toggle micro focus (Q)"
              >
                FOCUS&nbsp;[Q]
              </button>
              <div id="mode-focus-label" class="mode-focus-label">-</div>
            </div>

          </div>

        </div>

        <!-- Gizmo -->
        <div id="gizmo-wrapper">
          <!-- HOMEï¼ˆã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆï¼‰ -->
          <button
            id="gizmo-home"
            class="keycap"
            type="button"
            data-gizmo="home"
            title="Reset camera (HOME)"
          >
            HOME
          </button>

          <!-- è»¸ã‚¹ãƒŠãƒƒãƒ—ãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ã«æ¨ªä¸¦ã³ï¼‰ -->
          <div class="gizmo-axis-row">
            <button
              class="gizmo-axis keycap"
              type="button"
              data-gizmo-axis="x"
              title="+X axis"
            >
              X
            </button>
            <button
              class="gizmo-axis keycap"
              type="button"
              data-gizmo-axis="y"
              title="+Y axis"
            >
              Y
            </button>
            <button
              class="gizmo-axis keycap"
              type="button"
              data-gizmo-axis="z"
              title="+Z axis"
            >
              Z
            </button>
          </div>

          <!-- ä¸­èº«ã® SVG ã‚®ã‚ºãƒ¢ã¯ã“ã“ã«å·®ã—è¾¼ã¾ã‚Œã‚‹ -->
          <div id="gizmo-slot"></div>
        </div>

      <!-- å³ï¼šãƒ¡ã‚¿æƒ…å ±ã‚¨ãƒªã‚¢ -->
      <aside id="viewer-meta">
        <div id="meta-header">
          <a id="meta-logo-link" href="/viewer/">
            <img
              id="meta-logo"
              src="../assets/logo/3DSD-viewer.svg"
              alt="3DSD-viewer"
            />
          </a>
        </div>

        <div id="meta-file">
          <h3>File</h3>
          <div>(no file yet)</div>
        </div>
        <div id="meta-model">
          <h3>Model</h3>
          <div>(logs will appear here)</div>
        </div>
      </aside>
    </div>
      <script type="module" src="./viewerDevHarness.js"></script>
    </body>
</html>
