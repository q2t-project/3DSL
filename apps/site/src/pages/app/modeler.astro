---
---


<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Modeler | 3DSL</title>
    <meta name="description" content="3DSD Modeler をサイト共通レイアウトから隔離して表示する埋め込みホスト（/app/modeler）。" />
    <meta name="robots" content="noindex,nofollow" />
  </head>
  <body>
    <div id="app-modeler-progress" class="app-modeler-progress">
      <div class="app-modeler-progress-bar"></div>
    </div>


    <div class="app-modeler-overlay" role="note" aria-label="Modeler public alpha notice">
      <div class="app-modeler-badge">β Public Alpha</div>
      <a class="app-modeler-link" href="/docs/modeler/public-alpha" target="_blank" rel="noopener noreferrer">使い方・注意</a>
      <a class="app-modeler-link" href="/docs/modeler/IMPLEMENTATION_REPORT" target="_blank" rel="noopener noreferrer">進捗</a>
      <div class="app-modeler-note">iOS Safari では Save/SaveAs/Export はダウンロード扱い（上書き不可）。</div>

      <div class="app-modeler-actions" role="group" aria-label="Modeler quick actions">
        <button class="app-modeler-btn" type="button" data-cmd="sample" title="サンプルを開く">Sample</button>
        <button class="app-modeler-btn" type="button" data-cmd="reload" title="リロード（復帰）">Reload</button>
        <button class="app-modeler-btn" type="button" data-cmd="discard" title="未適用の編集を破棄">Discard</button>
        <button class="app-modeler-btn" type="button" data-cmd="export" title="Export（ダウンロード）">Export</button>
      </div>
    </div>


    <iframe
      id="app-modeler-iframe"
      class="app-modeler-iframe"
      title="3DSD Modeler"
      loading="eager"
      allow="clipboard-read; clipboard-write"
    ></iframe>

    <script>
      (() => {
        const iframe = document.getElementById("app-modeler-iframe");
        const progressEl = document.getElementById("app-modeler-progress");

        function showProgress() {
          if (!progressEl) return;
          progressEl.setAttribute("data-on", "1");
        }
        function hideProgress() {
          if (!progressEl) return;
          progressEl.removeAttribute("data-on");

        const overlay = document.querySelector(".app-modeler-overlay");

        function postCmd(action, payload = null) {
          try {
            const msg = { type: "3DSL_MODELER_CMD", action, payload };
            iframe?.contentWindow?.postMessage?.(msg, "*");
          } catch {}
        }

        function openSample() {
          const sampleUrl = "/3dss/fixtures/regression/valid_no_frames.3dss.json";
          const u = new URL("/modeler_app/index.html", window.location.origin);
          u.searchParams.set("url", sampleUrl);
          iframe.src = u.pathname + u.search;
          showProgress();
        }

        function wireQuickActions() {
          if (!overlay) return;
          overlay.querySelectorAll("[data-cmd]").forEach((btn) => {
            btn.addEventListener("click", () => {
              const cmd = btn.getAttribute("data-cmd");
              if (cmd === "sample") { openSample(); return; }
              if (cmd === "reload") { postCmd("reload"); return; }
              if (cmd === "discard") { postCmd("discard"); return; }
              if (cmd === "export") { postCmd("export"); return; }
            });
          });
        }
        }

        // NOTE: /modeler is currently used by Astro pages.
        // Keep the bundle base under /modeler_app (temporary) and target index.html to avoid redirect loops.
        const url = new URL(window.location.href);
        const q = url.search || "";
        const h = url.hash || "";
        const src = "/modeler_app/index.html" + q + h;

        showProgress();
        iframe.src = src;
        wireQuickActions();

        iframe.addEventListener("load", () => {
          hideProgress();
        });
      })();
    </script>

    <style>

      .app-modeler-overlay {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 99998;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(20, 20, 24, 0.78);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: #eaeaf0;
        backdrop-filter: blur(10px);
      }
      .app-modeler-badge {
        font-weight: 700;
        letter-spacing: 0.02em;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(255, 196, 0, 0.16);
        border: 1px solid rgba(255, 196, 0, 0.35);
      }
      .app-modeler-link {
        color: #eaeaf0;
        text-decoration: none;
        font-size: 14px;
        opacity: 0.92;
      }
      .app-modeler-link:hover { opacity: 1; text-decoration: underline; }
      .app-modeler-actions { display: flex; gap: 8px; align-items: center; }
      .app-modeler-btn {
        appearance: none;
        border: 1px solid rgba(255,255,255,0.18);
        background: rgba(255,255,255,0.06);
        color: #eaeaf0;
        padding: 6px 10px;
        border-radius: 10px;
        font-size: 13px;
        cursor: pointer;
      }
      .app-modeler-btn:hover { background: rgba(255,255,255,0.10); }
      .app-modeler-btn:active { transform: translateY(1px); }


      html, body { height: 100%; margin: 0; background: #0b0b0d; }
      .app-modeler-iframe {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
      }

      .app-modeler-progress {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        z-index: 99999;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      .app-modeler-progress[data-on] { opacity: 1; }
      .app-modeler-progress-bar {
        height: 100%;
        width: 30%;
        background: rgba(255, 255, 255, 0.75);
        filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.2));
        animation: app-modeler-progress-move 1.0s ease-in-out infinite;
      }
      @keyframes app-modeler-progress-move {
        0% { transform: translateX(-35%); }
        100% { transform: translateX(335%); }
      }
    </style>
  </body>
</html>
