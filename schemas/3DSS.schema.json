{
"$schema": "https://json-schema.org/draft/2020-12/schema",
"$id": "https://q2t-project.github.io/3dsl/schemas/3DSS.schema.json#v1.0.0",
"title": "3DSS Schema v1.0.0",
"explanation": "Three-Dimensional Structural Schema for 3DSL. This schema defines the structure, semantics, and metadata conventions for 3DSL documents. Version 1.0.0 (SemVer).",
"type": "object",
  
"properties": {
    "lines": {
        "type": "array",
        "items": {
            "type": "object",
            "properties": {
                "signification": {
                    "type": "object",
                    "properties": {
                        "relation": {
                            "type": "object",
                            "properties": {
                                "structural": { "type": "string", "enum": ["association", "containment", "hierarchy"] },
                                "dynamic": { "type": "string", "enum": ["causal", "flow", "influence", "derivation", "transformation", "feedback", "recursion", "reflection"] },
                                "logical": { "type": "string", "enum": ["equivalence", "negation", "implication", "support", "conflict"] },
                                "temporal": { "type": "string", "enum": ["precedence", "succession"] },
                                "meta": { "type": "string", "enum": ["reference", "annotation"] }
                            }, "additionalProperties": false
                        },
                        "sense": {
                            "type": "string",
                            "enum": ["a_to_b", "b_to_a", "bidirectional", "neutral"],
                            "default": "a_to_b"
                        }
                    },"additionalProperties": false
                },
                "appearance": {
                    "type": "object",
                    "properties": {
                        "end_a": {
                            "oneOf": [
                                {   "type": "object",
                                    "properties": {
                                        "ref": {
                                            "type": "string", 
                                            "format": "uuid"
                                        }
                                    }, "required": ["ref"], "additionalProperties": false
                                },
                                {   "type": "object",
                                    "properties": {
                                        "coord": { "type": "array",  "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
                                    }, "required": ["coord"], "additionalProperties": false
                                }
                            ]
                        },
                        "end_b": {
                            "oneOf": [
                                {   "type": "object",
                                    "properties": {
                                        "ref": { 
                                            "type": "string", 
                                            "format": "uuid"
                                        }
                                    }, "required": ["ref"], "additionalProperties": false
                                },
                                {   "type": "object",
                                    "properties": {
                                        "coord": { "type": "array",  "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
                                    }, "required": ["coord"], "additionalProperties": false
                                }
                            ]
                        },
                        "visible": { "type": "boolean", "default": true },
                        "line_type": { "type": "string", "enum": ["straight", "polyline", "catmullrom", "bezier", "arc"], "default": "straight" },
                        "geometry": { "$ref": "#/$defs/validator/line_geometry"},
                        "line_style": { "type": "string", "enum": ["solid", "dashed", "dotted", "double", "none"], "default": "solid" },
                        "color": { "$ref": "#/$defs/validator/type_check/color", "default": "#ffffff" },
                        "opacity": { "type": "number", "minimum": 0, "maximum": 1, "default": 1.0 },
                        "renderOrder": { "type": ["number", "integer", "string"], "default": 0 },
                        "arrow": {
                            "type": "object",
                            "properties": {
                                "shape": { "type": "string", "enum": ["cone", "pyramid", "line"] },
                                "size": { "type": "number", "default": 1.0 },
                                "aspect": { "type": "number", "default": 1.0 },
                                "placement": { "type": "string", "enum": ["end_a", "end_b", "both", "none"], "default": "end_b" },
                                "auto_orient": { "type": "boolean", "default": true }
                            }, "required": ["placement"], "additionalProperties": false
                        },
                         "effect": {
                            "type": "object",
                            "properties": {
                                "effect_type": { "type": "string", "enum": ["none", "pulse", "flow", "glow"], "default": "none" },
                                "amplitude": { "type": "number", "minimum": 0, "default": 1.0 },
                                "speed": { "type": "number", "minimum": 0, "default": 1.0 },
                                "duration": { "type": "number", "minimum": 0, "default": 1.0 },
                                "loop": { "type": "boolean", "default": true },
                                "phase": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.0 },
                                "easing": { "type": "string", "enum": ["linear", "ease-in", "ease-out", "ease-in-out"], "default": "linear" },
                                "width": { "type": "number", "default": 1.0 }
                            }, "additionalProperties": false
                        }
                    },
                    "allOf": [
                        {   "if": { "properties": { "line_type": { "enum": ["polyline", "catmullrom", "bezier", "arc"] } } },
                            "then": { "required": ["geometry"] }
                        }
                    ]
                },
                "meta": {
                    "type": "object",
                    "properties": {
                        "uuid": { "type": "string", "format": "uuid" },
                        "tags": { "type": "array", "items": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$" } },
                        "creator_memo": { "type": "string" }
                    }, "required": ["uuid"],"additionalProperties": false
                }
            }, "required": ["appearance", "meta"], "additionalProperties": false
        }
    },

    "points": {
        "type": "array",
        "items": {
            "type": "object",
            "properties": {
                "signification": {
                    "type": "object",
                    "properties": {
                        "name": {
                            "oneOf": [
                                { "type": "string" },
                                { "type": "object", "properties": { "ja": { "type": "string" }, "en": { "type": "string" } }, "additionalProperties": false }
                            ]
                        }
                    },"additionalProperties": false
                },
                "appearance": {
                    "type": "object",
                    "properties": {
                        "position": {"type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
                        "marker": {
                            "type": "object",
                            "properties": {
                                "common": {
                                    "type": "object",
                                    "properties": {
                                        "visible": { "type": "boolean", "default": true },
                                        "orientation": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3,"default":[0,0,0] },
                                        "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3,"default":[1,1,1] },
                                        "color": { "$ref": "#/$defs/validator/type_check/color", "default": "#ffffff" },
                                        "opacity": { "type": "number", "minimum": 0, "maximum": 1, "default": 1.0 },
                                        "emissive": { "type": ["boolean", "string"], "default": false },
                                        "wireframe": { "type": "boolean", "default": false }
                                    }, "additionalProperties": false
                                },
                                "shape": { "type": "string", "enum": ["sphere", "box", "cone", "pyramid", "corona", "none"], "default": "sphere" },
                                "gltf": {
                                    "type": "object",
                                    "properties": {
                                        "url": { "type": "string" },
                                        "scale": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
                                        "rotation": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
                                        "offset": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 }
                                    }, "additionalProperties": false
                                },
                                "text": {
                                    "type": "object",
                                    "properties": {
                                        "content": { "type": "string" },
                                        "font": { "type": "string", "default": "helvetiker_regular" },
                                        "size": { "type": ["number", "integer"], "default": 1.0 },
                                        "align": { "type": "string", "pattern": "^(left|center|right)\\s*&\\s*(top|middle|baseline)$" },
                                        "billboard": { "type": "boolean", "default": true },
                                        "plane": { "type": "string", "enum": ["xy", "yz", "zx"], "default": "xy" }
                                    }, "additionalProperties": false
                                }
                            }, "additionalProperties": false
                        }
                    }, "required": ["position"], "additionalProperties": false
                },
                "meta": {
                    "type": "object",
                    "properties": {
                        "uuid": { "type": "string", "format": "uuid" },
                        "tags": { "type": "array", "items": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$" } },
                        "creator_memo": { "type": "string" }
                    }, "required": ["uuid"], "additionalProperties": false
                }
            }, "required": ["appearance", "meta"], "additionalProperties": false
        }
    },

    "aux": {
        "type": "array",
        "items": {
            "type": "object",
            "properties": {
                "appearance": {
                    "type": "object",
                    "properties": {
                        "grid": {
                            "type": "object",
                            "properties": {
                                "grid_type": { "type": "string", "enum": ["cartesian", "polar"], "default": "cartesian" },
                                "subdivisions": { "type": ["integer"],"default": 10 }, 
                                "major_step": { "type": ["number", "integer"],"default": 1 },
                                "minor_step": { "type": ["number", "integer"],"default": 0.1 },
                                "color_major": { "$ref": "#/$defs/validator/type_check/color", "default": "#666666" },
                                "color_minor": { "$ref": "#/$defs/validator/type_check/color", "default": "#333333" }
                            }, "additionalProperties": false
                        },
                        "axis": {
                            "type": "object",
                            "properties": {
                                "length": { "type": ["number", "integer"], "default": 10 },
                                "labels": { "type": "boolean", "default": true  },
                                "arrow": { "type": "boolean", "default": true }
                            }, "additionalProperties": false
                        },
                        "plate": {
                            "type": "object",
                            "properties": {
                                "plane": { "type": "string", "enum": ["xy", "yz", "zx"], "default": "xy" },
                                "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3, "default": [0, 0, 0] },
                                "size": { "type": "array", "items": { "type": "number" }, "minItems": 2, "maxItems": 2, "default": [10, 10] },
                                "reflectivity": { "type": "number", "minimum": 0, "maximum": 1, "default": 0 },
                                "opacity": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.2 }
                            }, "additionalProperties": false
                        },
                        "shell": { "type": "object",
                            "properties": {
                                "shell_type": { "type": "string", "enum": ["sphere", "box", "hemisphere", "quarter_sphere", "eighth_sphere"], "default": "sphere" },
                                "opacity": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.3 },
                                "reflectivity": { "type": "number", "minimum": 0, "maximum": 1, "default": 0 },
                                "effect": {
                                    "type": "object",
                                    "properties": {
                                        "edge_intensity": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.5 },
                                        "rimlight": { "type": "boolean", "default": false },
                                        "glow_color": { "$ref": "#/$defs/validator/type_check/color", "default": "#ff0000" }
                                    }, "additionalProperties": false
                                }
                            },"additionalProperties": false
                        },
                        "hud": {
                            "type": "object",
                            "properties": {
                                "follow_camera": { "type": "boolean", "default": true },
                                "scale_with_distance": { "type": "boolean", "default": true }
                            }, "additionalProperties": false
                        },
                        "position": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3, "default": [0, 0, 0] },
                        "orientation": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3, "default": [0, 0, 0] },
                        "opacity": { "type": "number", "minimum": 0, "maximum": 1, "default": 1.0 }
                    }, "additionalProperties": false
                },
                "meta": {
                    "type": "object",
                    "properties": {
                        "uuid": { "type": "string", "format": "uuid" },
                        "creator_memo": { "type": "string" }
                    }, "required": ["uuid"], "additionalProperties": false
                }
            }, "required": ["meta"], "additionalProperties": false
        }
    },

    "document_meta": {
        "type": "object",
        "properties": {
            "document_uuid": { "type": "string", "format": "uuid" },
            "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?$", "default": "1.0.0" },
            "updated_at": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$" },
            "document_tags": { "type": "array", "items": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$"} },
            "tags": { "type": "array", "items": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$" } },
            "schema_uri": { "type": "string", "format": "uri" },
            "generator": { "type": "string", "format": "uri" },
            "reference": { "type": "string" },
            "coordinate_system": { "type": "string", "enum": [ "X+Y=+Z/up:x", "X+Y=+Z/up:y", "X+Y=+Z/up:z", "X+Y=-Z/up:x", "X+Y=-Z/up:y", "X+Y=-Z/up:z"], "default": "X+Y=+Z/up:z" },
            "units": { "type": "string", "enum": [ "m", "cm", "mm", "non_si:px"],"default": "m" },
            "i18n": { "type": "string", "enum": ["ja", "en"],"default": "ja" },
            "author": { "type": "string", "pattern": "^[a-zA-Z0-9._-]+(@[a-zA-Z0-9.-]+)?$" },
            "creator_memo": { "type": "string" }            
        }, "required": ["document_uuid", "schema_uri", "author", "version"], "additionalProperties": false
    }
}, "required": ["document_meta"],

"$defs": {
    "validator": {
        "type": "object",
        "properties": {
            "type_check": {
                "type": "object",
                    "properties": {
                        "uuid": { "type": "string", "format": "uuid" },
                        "uri": { "type": "string", "format": "uri" },
                        "text_label": { "type": "string", "minLength": 1, "maxLength": 512 },
                        "tag": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$" },
                        "language_code": { "type": "string", "enum": ["ja", "en"] },
                        "units": { "type": "string", "enum": ["m", "cm", "mm", "non_si:px"] },
                        "color": { "type": "string", "pattern": "^#(?:[0-9a-fA-F]{3}){1,2}$" },
                        "filename": { "type": "string", "pattern": "^[\\w,\\s-]+\\.[A-Za-z]{1,6}$" },
                        "author": { "type": "string", "pattern": "^[a-zA-Z0-9._-]+(@[a-zA-Z0-9.-]+)?$" },
                        "numeric_value": { "type": "number" },
                        "integer_value": { "type": "integer" },
                        "boolean_flag": { "type": "boolean" },
                        "vector2": { "type": "array", "items": { "type": "number" }, "minItems": 2, "maxItems": 2 },
                        "vector3": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
                        "vector4": { "type": "array", "items": { "type": "number" }, "minItems": 4, "maxItems": 4 },
                        "date_iso": { "type": "string", "format": "date" },
                        "timestamp_utc": { "type": "string", "format": "date-time", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$" },
                        "string_array": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
                        "number_array": { "type": "array", "items": { "type": "number" }, "minItems": 1 },
                        "uuid_array": { "type": "array", "items": { "type": "string", "format": "uuid" }, "minItems": 1 },
                        "any": {}
                    }, "additionalProperties": false
            },
            "pattern": {
                "type": "object",
                "properties": {
                    "tag": { "type": "string", "pattern": "^(s|m|x):[a-z0-9_\\-]+$" },
                    "uuid_v4": { "type": "string", "pattern": "^[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-4[0-9a-fA-F]{3}\\-[89abAB][0-9a-fA-F]{3}\\-[0-9a-fA-F]{12}$" },
                    "uri": { "type": "string", "pattern": "^(https?|ftp|file)://[\\w.-]+(/[\\w\\-./?%&=]*)?$" },
                    "semver": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)*)?$" },
                    "timestamp_utc": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$" },
                    "author": { "type": "string", "pattern": "^[a-zA-Z0-9._-]+(@[a-zA-Z0-9.-]+)?$" },
                    "lang_code": { "type": "string", "pattern": "^(ja|en)$" },
                    "units": { "type": "string", "pattern": "^(m|cm|mm|non_si:px)$" },
                    "path_ref": { "type": "string", "pattern": "^[\\w\\-/\\.]+$" }
                }, "additionalProperties": false
            },
            "enum_constraint": {
                "type": "object",
                "properties": {
                    "language": { "type": "string", "enum": ["ja", "en"] },
                    "units": { "type": "string", "enum": ["m", "cm", "mm", "non_si:px"] },
                    "coordinate_system": { "type": "string", "enum": ["X+Y=+Z/up:x", "X+Y=+Z/up:y", "X+Y=+Z/up:z", "X+Y=-Z/up:x", "X+Y=-Z/up:y", "X+Y=-Z/up:z"] },
                    "relation_structural": { "type": "string", "enum": ["association", "containment", "hierarchy"] },
                    "relation_dynamic": { "type": "string", "enum": ["causal", "flow", "influence", "derivation", "transformation", "feedback", "recursion", "reflection"] },
                    "relation_logical": { "type": "string", "enum": ["equivalence", "negation", "implication", "support", "conflict"] },
                    "relation_temporal": { "type": "string", "enum": ["precedence", "succession"] },
                    "relation_meta": { "type": "string", "enum": ["reference", "annotation"] },
                    "sense": { "type": "string", "enum": ["a_to_b", "b_to_a", "bidirectional", "neutral"] },
                    "line_style": { "type": "string", "enum": ["solid", "dashed", "dotted", "double", "none"] },
                    "arrow_shape": { "type": "string", "enum": ["cone", "pyramid", "line"] },
                    "arrow_placement": { "type": "string", "enum": ["end_a", "end_b", "both", "none"] },
                    "marker_shape": { "type": "string", "enum": ["sphere", "box", "cone", "pyramid", "corona", "none"] },
                    "marker_plane": { "type": "string", "enum": ["xy", "yz", "zx"] },
                    "text_align": { "type": "string", "enum": [ "left&top", "left&middle", "left&baseline", "center&top", "center&middle", "center&baseline", "right&top", "right&middle", "right&baseline"]},
                    "effect_type": { "type": "string", "enum": ["pulse", "flow", "glow", "none"] },
                    "easing_mode": { "type": "string", "enum": ["linear", "ease-in", "ease-out", "ease-in-out"] },
                    "schema_status": { "type": "string", "enum": ["stable", "beta", "deprecated"] },
                    "document_tag_system": { "type": "string", "enum": ["s", "m", "x"] }
                }, "additionalProperties": false
            },
            "required_sets": {
                "type": "object",
                "properties": {
                    "document_meta": { "type": "array", "const": ["document_uuid", "schema_uri", "author", "version"] },
                    "point_item": { "type": "array", "const": ["appearance", "meta"] },
                    "line_item": { "type": "array", "const": ["appearance", "meta"] },
                    "aux_item": { "type": "array", "const": ["meta"] },
                    "meta_core": { "type": "array", "const": ["uuid"] },
                    "relation_core": { "type": "array", "const": ["relation", "sense"] },
                    "appearance_core": { "type": "array", "const": ["visible", "renderOrder", "color", "opacity"] },
                    "validator_core": { "type": "array", "const": ["type_check", "pattern", "enum_constraint", "required_sets"] }
                }, "additionalProperties": false
            },
            "ref_integrity": {
                "type": "object",
                "properties": {
                    "ref_target_type": { "type": "string", "enum": ["point"], "default": "point" },
                    "allow_self_reference": { "type": "boolean", "default": false },
                    "allow_cross_reference": { "type": "boolean", "default": false }
                }, "additionalProperties": false
            },
            "line_geometry": {
                "type": "object",
                "properties": {
                    "dimension": {"type": "integer", "enum": [2, 3], "default": 3 },
                    "polyline_points": { "type": "array", "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 } },
                    "bezier_controls": { "type": "array", "minItems": 1, "maxItems": 2, "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 } },
                    "arc_center": {"type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 },
                    "arc_radius": { "type": "number", "minimum": 0 },
                    "arc_angle_start": { "type": "number" },
                    "arc_angle_end": { "type": "number" },
                    "arc_clockwise": { "type": "boolean", "default": true },
                    "catmullrom_points": { "type": "array", "items": { "type": "array", "items": { "type": "number" }, "minItems": 3, "maxItems": 3 } },
                    "catmullrom_tension": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.5 }
                }, "additionalProperties": false
            }
        }, "additionalProperties": false
    },
    "extension": {
        "type": "object",
        "properties": {
            "parametric": {
                "type": "object",
                "additionalProperties": true
            },
            "semantic_generation": {
                "type": "object",
                "additionalProperties": true
            }
        }, "additionalProperties": false
    }
},"additionalProperties": false
}